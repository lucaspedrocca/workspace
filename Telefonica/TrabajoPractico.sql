CREATE TABLE LIBRO (NRO_LIBRO int not null,
                    TITULO char(40),
                    AUTOR char(30),
                    TIPO char(2),
                    PRECIO_ORI decimal(10,2),
                    PRECIO_ACT decimal(10,2),
                    EDICION smallint);

CREATE TABLE TIPOLIBRO (TIPO char(2),
                        DESCTIPO char(40));

CREATE TABLE LECTOR (NRO_LECTOR int,
                    NOMBRE char(22),
                    DIRECCION char(30),
                    TRABAJO char(10),
                    SALARIO decimal(10,2));

CREATE TABLE COPIA (NRO_LIBRO int,
                    NRO_COPIA smallint);

CREATE TABLE PRESTAMO (NRO_LECTOR int,
                    NRO_LIBRO int,
                    NRO_COPIA smallint,
                    F_PREST datetime,
                    F_DEVOL datetime);

/* Para DML de Libros */
/* Libros */
INSERT INTO LIBRO VALUES (5078912,'LAS MIL Y UNA NOCHES','GALLAND A.','no',20.30,34.20,1948);
INSERT INTO LIBRO VALUES (6094527,'FUENTEOVEJUNA','LOPE DE VEGA','no',18.35,32.10,1978);
INSERT INTO LIBRO VALUES (7034567,'DICCIONARIO ITALIANOESPANOL','CERRUTI J.','di',32.70,32.70,1992);
INSERT INTO LIBRO VALUES (8235698,'ETICA Y DEONTOLOGIA DOCENTE','RUIZ DANIEL J.','es',54.20,76.30,1990);
INSERT INTO LIBRO VALUES (8753124,'TABLE GAMES','MARRAN','ju',12.50,13.25,1991);
INSERT INTO LIBRO VALUES (9076234,'BOTANICA MEDICINAL','TRABUT L.','es',123.48,143.20,1978);
INSERT INTO LIBRO VALUES (9456789,'EL CORONEL NO TIENE QUIEN LE ESCRIBA','GARCIA MARQUEZ GABRIEL','no',23.20,31.21,1978);
INSERT INTO LIBRO VALUES (9876079,'HISTORIA DE JULIO CESAR','OCHOA EUGENIO','es',154.30,167.20,1946);
INSERT INTO LIBRO VALUES (10545377,'LA HOJARASCA','GABRIEL GARCIA MARQUEZ','no',12.10,15.20,1988);
INSERT INTO LIBRO VALUES (10558904,'FICCIONES','BORGES JORGE LUIS','cu',23.70,25.40,1979);
INSERT INTO LIBRO VALUES (10574387,'SALON DE LECTURA','DENEVI MARCO','cu',14.50,16.10,1980);
INSERT INTO LIBRO VALUES (10654324,'HISTORIA ARGENTINA','BUSANICHE J.L.','es',56.30,59.30,1985);
INSERT INTO LIBRO VALUES (10789443,'DICCIONARIO INGLESESPANOL','APPLETON-CUYAS','di',98.30,123.50,1986);

/* Tipo Libro */
INSERT INTO TIPOLIBRO VALUES ('cu', 'Cuentos');
INSERT INTO TIPOLIBRO VALUES ('di', 'Diccionario');
INSERT INTO TIPOLIBRO VALUES ('es', 'Estudio');
INSERT INTO TIPOLIBRO VALUES ('ju', 'Juegos');
INSERT INTO TIPOLIBRO VALUES ('no', 'Novela');

/* COPIAS */
INSERT INTO COPIA VALUES (5078912, 1);
INSERT INTO COPIA VALUES (6094527, 1);
INSERT INTO COPIA VALUES (7034567, 1);
INSERT INTO COPIA VALUES (8235698, 1);
INSERT INTO COPIA VALUES (8753124, 1);
INSERT INTO COPIA VALUES (9076234, 1);
INSERT INTO COPIA VALUES (9456789, 1);
INSERT INTO COPIA VALUES (9876079, 1);
INSERT INTO COPIA VALUES (10545377, 1);
INSERT INTO COPIA VALUES (10558904, 1);
INSERT INTO COPIA VALUES (10574387, 1);
INSERT INTO COPIA VALUES (10654324, 1);
INSERT INTO COPIA VALUES (10789443, 1);
INSERT INTO COPIA VALUES (5078912, 2);
INSERT INTO COPIA VALUES (6094527, 2);
INSERT INTO COPIA VALUES (7034567, 2);
INSERT INTO COPIA VALUES (8235698, 2);
INSERT INTO COPIA VALUES (8753124, 2);
INSERT INTO COPIA VALUES (9076234, 2);
INSERT INTO COPIA VALUES (9456789, 2);
INSERT INTO COPIA VALUES (9876079, 2);
INSERT INTO COPIA VALUES (10545377, 2);
INSERT INTO COPIA VALUES (10558904, 2);
INSERT INTO COPIA VALUES (10574387, 2);
INSERT INTO COPIA VALUES (10654324, 2);
INSERT INTO COPIA VALUES (10789443, 2);
INSERT INTO COPIA VALUES (5078912, 3);
INSERT INTO COPIA VALUES (6094527, 3);
INSERT INTO COPIA VALUES (7034567, 3);
INSERT INTO COPIA VALUES (8235698, 3);
INSERT INTO COPIA VALUES (8753124, 3);
INSERT INTO COPIA VALUES (9076234, 3);
INSERT INTO COPIA VALUES (9456789, 3);
INSERT INTO COPIA VALUES (9876079, 3);
INSERT INTO COPIA VALUES (10545377, 3);
INSERT INTO COPIA VALUES (10558904, 3);
INSERT INTO COPIA VALUES (10574387, 3);
INSERT INTO COPIA VALUES (10654324, 3);
INSERT INTO COPIA VALUES (10789443, 3);

/* Lector */
INSERT INTO LECTOR VALUES (123456,'GOMEZ Arnoldo','Avda. La Reja 2234 - Capital','EMPLEADO',1234.50);
INSERT INTO LECTOR VALUES (123467,'FERNANDEZ Guillermo','San Pedro 987 - Moron','EJECUTIVO',3245.50);
INSERT INTO LECTOR VALUES (123478,'GARCIA Manuel','Avda de los Sioux 2211 - Korn','VENDEDOR',1345.50);
INSERT INTO LECTOR VALUES (123489,'VALLEJOS Pancracio','San Martin 231 - Capital Fed.','EMPLEADO',734.60);
INSERT INTO LECTOR VALUES (123490,'APPICCIAFUOCO Gerardo','De los Rosales 234 - Merlo','EMPLEADO',534.20);
INSERT INTO LECTOR VALUES (123491,'BANKO Lou','Tres Sargentos 333 - V.Plot','VENDEDOR',1215.30);
INSERT INTO LECTOR VALUES (123494,'CASTA?A Jorge','Avda. de los Peruanos 1234','EJECUTIVO',2453.90);
INSERT INTO LECTOR VALUES (124200,'MARENGHI Pick','De las Rosas 234 - Palomar','EMPLEADO',975.40);
INSERT INTO LECTOR VALUES (124230,'PEREZ GIL Miguel','Los Tomatoes 125 - V.Adelina','COMERCIANT',1345.45);
INSERT INTO LECTOR VALUES (124231,'MIRANDA Hermenegildo','San Cono 901 - V.Milagros','VENDEDOR',856.30);
INSERT INTO LECTOR VALUES (124392,'MOLINO Gualterio','Potatoes 29357 - Palermo','COMERCIANT',2356.45);
INSERT INTO LECTOR VALUES (125376,'PIE Lemon','Rivadavia 2890 - V.Tesei','EJECUTIVO',3020.40);
INSERT INTO LECTOR VALUES (125678,'MARTINEZ Charles','De las Amapolas 124 B.Chino','COMERCIANT',2357.40);
INSERT INTO LECTOR VALUES (125789,'YAMIMOTO Scutter','Biela 4325 Dpto.3 4P - Cap.','COMERCIANT',1876.50);

/* Prestamos */
INSERT INTO PRESTAMO VALUES (123456,10545377,1,'2013-07-01', '2013-07-10');
INSERT INTO PRESTAMO VALUES (123491,10545377,2,'2013-07-02', null);
INSERT INTO PRESTAMO VALUES (123478,10545377,3,'2013-07-03', null);
INSERT INTO PRESTAMO VALUES (125376,10545377,1,'2013-07-15', '2013-07-20');
INSERT INTO PRESTAMO VALUES (123456,10558904,1,'2013-07-01', null);
INSERT INTO PRESTAMO VALUES (124231,10558904,2,'2013-07-02', null);
INSERT INTO PRESTAMO VALUES (123478,9456789,1,'2013-07-02','2013-07-08');
INSERT INTO PRESTAMO VALUES (123490,10558904,2,'2013-07-03', null);

/* Ejercicios */

/* Ejercicio 1 */

SELECT TITULO, AUTOR, TIPO, PRECIO_ORI
FROM libro
WHERE tipo = "no" AND PRECIO_ORI > 21

/* Ejercicio 2 */

SELECT TITULO, AUTOR, TIPO, PRECIO_ORI
FROM libro
WHERE tipo = "no" OR PRECIO_ORI > 21

/* Ejercicio 3 */

SELECT NRO_LIBRO, PRECIO_ORI, EDICION
FROM libro
WHERE (tipo = "no" OR PRECIO_ORI > 21) AND EDICION > 1985

/* Ejercicio 4 */

SELECT TITULO, PRECIO_ORI, EDICION
FROM libro
WHERE EDICION IN (1948,1978,1985)

/* Ejercicio 5 */

SELECT TITULO, EDICION, PRECIO_ORI
FROM libro
WHERE PRECIO_ORI BETWEEN 12 AND 25

/* Ejercicio 6 */

SELECT TITULO, PRECIO_ORI, EDICION
FROM libro
WHERE TITULO LIKE "%R%S%"

/* Ejercicio 7 */

SELECT TITULO, PRECIO_ORI, EDICION
FROM libro
WHERE TITULO LIKE "_A%"

/* Ejercicio 8 */

SELECT AUTOR, EDICION, TITULO
FROM libro
WHERE AUTOR NOT LIKE "G%"

/* Ejercicio 9 */

SELECT TITULO, EDICION, PRECIO_ORI
FROM libro
WHERE PRECIO_ORI NOT BETWEEN 12 AND 25

/* Ejercicio 10 */

SELECT NRO_LIBRO, EDICION, TIPO, PRECIO_ORI
FROM libro
WHERE PRECIO_ORI > 20 
ORDER BY EDICION DESC, NRO_LIBRO ASC

/* Ejercicio 11 */

SELECT TIPO, EDICION
FROM libro
ORDER BY TIPO ASC, EDICION ASC

/* Ejercicio 12 */

SELECT DISTINCT TIPO, EDICION
FROM libro
ORDER BY TIPO ASC, EDICION ASC

/*La unica diferencia que se puede observar entre la consulta 11 y 12, es una fila que tiene el mismo valor tanto en tipo y ediciÃ³n, que en la consulta 12 no es tomada en cuenta por consecuencia de haber declarado estos valores como DISTINCT.*/

/* Ejercicio 13 */

SELECT NRO_LIBRO, EDICION, TIPO, PRECIO_ORI, PRECIO_ACT, PRECIO_ACT - PRECIO_ORI as DIFERENCIA
FROM libro
WHERE PRECIO_ACT - PRECIO_ORI > 10
ORDER BY DIFERENCIA DESC

/* Ejercicio 14 */

SELECT SUM(PRECIO_ORI) AS SumaOrig,
	   AVG(PRECIO_ORI) AS PromedioOrig,
       MIN(PRECIO_ACT) AS MinimoActual, 
       MAX(PRECIO_ACT) AS MaximoActual
FROM libro
WHERE EDICION > 1970

/* Ejercicio 15 */

SELECT SUM(PRECIO_ORI) + SUM(PRECIO_ACT) AS Suma,
	   (SUM(PRECIO_ORI) + SUM(PRECIO_ACT)) / 2 AS PromedioSumas,
       MIN(PRECIO_ACT - PRECIO_ORI) AS DiferenciaMinima, 
       MAX(PRECIO_ACT - PRECIO_ORI) AS DiferenciaMaxima
FROM libro
WHERE EDICION > 1970

/* Ejercicio 16 */

SELECT COUNT(NRO_LIBRO) AS CantLibros,
	   COUNT(DISTINCT TIPO) AS CantTipos,
       MAX(PRECIO_ORI) AS MaxPrecioOri, 
       MIN(PRECIO_ORI) AS MinPrecioOri
FROM libro
WHERE PRECIO_ORI > 30

/* Ejercicio 17 */

SELECT 'PROMEDIO --->' AS 'PROMEDIO --->',
	   AVG(PRECIO_ACT) AS Promedio,
       'TOTAL --->' AS 'TOTAL --->',
       SUM(PRECIO_ACT) AS Total
FROM libro

/* Ejercicio 18 */

SELECT  DISTINCT Tipo,
		SUM(PRECIO_ORI) AS TotalPreOri,
        AVG(PRECIO_ACT) AS PromPreActual
FROM libro
Where NOT EDICION = 1946
GROUP BY(TIPO)
ORDER BY PromPreActual ASC

/* Ejercicio 19 */

SELECT  DISTINCT TIPO,
		SUM(PRECIO_ORI) AS Total_PreOrig,
        AVG(PRECIO_ACT) AS Prom_PreActual
FROM libro    
WHERE NOT EDICION = 1946
GROUP BY(TIPO)
HAVING SUM(PRECIO_ORI) > 40

/* Ejercicio 20 */

SELECT T1.NOMBRE, T1.DIRECCION
FROM LECTOR T1
JOIN PRESTAMO T2
	ON T2.NRO_LECTOR = T1.NRO_LECTOR
    WHERE T2.F_DEVOL IS NULL

/* Ejercicio 21 */

SELECT NRO_LIBRO, TITULO, PRECIO_ORI
FROM LIBRO
WHERE PRECIO_ORI > (SELECT AVG(PRECIO_ACT) FROM LIBRO)


/* Ejercicio 22 */

SELECT NRO_LIBRO, TITULO, PRECIO_ORI
FROM LIBRO
WHERE PRECIO_ORI >(SELECT MAX(PRECIO_ORI) FROM LIBRO WHERE (TIPO='no'))

/* Ejercicio 23 */

SELECT TIPO, AVG(PRECIO_ORI) as PROMEDIO
FROM LIBRO
GROUP BY (TIPO)
HAVING AVG(PRECIO_ORI) > (SELECT AVG(PRECIO_ORI) FROM LIBRO) 

/* Ejercicio 24 */

SELECT DISTINCT NOMBRE, 'Lector' as Tipo_Persona
FROM LECTOR
UNION
SELECT DISTINCT AUTOR,  'Autor' as Tipo_Persona
FROM LIBRO
ORDER BY NOMBRE

/* Ejercicio 25 */

SELECT t1.NRO_LIBRO, t1.TITULO, t2.F_PREST, t2.F_DEVOL
FROM LIBRO t1
JOIN PRESTAMO t2
	ON t1.NRO_LIBRO = t2.NRO_LIBRO

/* Ejercicio 26 */

SELECT t1.NRO_LECTOR, t1.NOMBRE, count(t2.nro_Lector)
FROM LECTOR t1
JOIN PRESTAMO t2
	ON t1.NRO_LECTOR = t2.NRO_LECTOR
GROUP BY NRO_LECTOR

/* Ejercicio 27 */

SELECT t2.NRO_LIBRO, t1.TITULO, count(t2.NRO_LIBRO)
FROM LIBRO t1
JOIN PRESTAMO t2
	ON t1.NRO_LIBRO = t2.NRO_LIBRO
    WHERE t2.F_PREST >= ('2012-01-01 00:00:00')
GROUP BY (NRO_LIBRO)

/* Ejercicio 28 */

SELECT DISTINCT t2.NRO_LIBRO, t1.TITULO, t2.NRO_COPIA, count(t2.NRO_COPIA) as PrestamosRealizados
FROM LIBRO t1
JOIN PRESTAMO t2
	ON t1.NRO_LIBRO = t2.NRO_LIBRO
GROUP BY T2.NRO_LIBRO, T2.NRO_COPIA

/* Ejercicio 29 */

SELECT DISTINCT t2.NRO_LIBRO, t1.TITULO, t2.NRO_COPIA, count(t2.NRO_COPIA) as PrestamosRealizados
FROM LIBRO t1
JOIN PRESTAMO t2
	ON t1.NRO_LIBRO = t2.NRO_LIBRO
GROUP BY T2.NRO_LIBRO, T2.NRO_COPIA
HAVING count(t2.NRO_COPIA) > 1

/* Ejercicio 30 */

SELECT DISTINCT t3.TITULO, t2.NOMBRE
FROM PRESTAMO t1
JOIN LECTOR t2
	ON t1.NRO_LECTOR = t2.NRO_LECTOR
JOIN LIBRO T3
	ON t1.NRO_LIBRO = T3.NRO_LIBRO
ORDER BY TITULO

/* Ejercicio 31 */

SELECT DISTINCT t2.NRO_LECTOR, t2.NOMBRE, t3.NRO_LIBRO, t3.TITULO, t1.F_PREST
FROM PRESTAMO t1 
JOIN LIBRO T3 JOIN LECTOR t2
	ON t1.NRO_LIBRO = T3.NRO_LIBRO AND t1.NRO_LECTOR = t2.NRO_LECTOR
    WHERE t1.F_DEVOL IS NOT NULL AND t3.TIPO in ('no','cu') 

/* Ejercicio 32 */

SELECT DISTINCT t2.NRO_LECTOR, t2.NOMBRE, t1.NRO_LIBRO, t1.F_PREST
FROM PRESTAMO t1 
JOIN LECTOR t2
	ON t1.NRO_LECTOR = t2.NRO_LECTOR 
    ORDER BY t2.NRO_LECTOR